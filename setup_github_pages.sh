#!/bin/bash

# üåê Script de Configura√ß√£o Autom√°tica do GitHub Pages
# Trabalho 2 RNP - Predi√ß√£o Mackey-Glass
# Autor: Rafael Ratacheski de Sousa Raulino

echo "üåê Configurando GitHub Pages para Trabalho 2 RNP..."
echo "=" * 60
echo "üìù Desenvolvido por: Rafael Ratacheski de Sousa Raulino"
echo "üéì Mestrando em Engenharia El√©trica e de Computa√ß√£o - UFG"
echo "üìö Disciplina: Redes Neurais Profundas - 2025/1"
echo "=" * 60

# Verificar se estamos no diret√≥rio correto
if [ ! -d "mackey_glass_prediction" ]; then
    echo "‚ùå Erro: Execute este script a partir da raiz do projeto (onde est√° a pasta mackey_glass_prediction)"
    exit 1
fi

# Criar estrutura do GitHub Pages
echo "üìÅ Criando estrutura do GitHub Pages..."
mkdir -p docs/images
mkdir -p docs/css
mkdir -p docs/js

# Encontrar pasta de resultados mais recente
RESULTS_DIR=$(find mackey_glass_prediction/experiments/results -name "final_report_*" -type d | sort | tail -1)

if [ -z "$RESULTS_DIR" ]; then
    echo "‚ùå Nenhuma pasta de resultados encontrada!"
    echo "üí° Execute primeiro:"
    echo "   cd mackey_glass_prediction/experiments"
    echo "   python run_experiment.py"
    echo "   cd ../.."
    echo "   python mackey_glass_prediction/generate_interactive_report.py"
    exit 1
fi

echo "üìÅ Copiando resultados de: $RESULTS_DIR"

# Copiar arquivos de resultados
echo "üìä Copiando imagens e relat√≥rios..."
cp -r "$RESULTS_DIR"/* docs/images/ 2>/dev/null || true

# Copiar relat√≥rio HTML principal
if [ -f "$RESULTS_DIR/relatorio.html" ]; then
    cp "$RESULTS_DIR/relatorio.html" docs/relatorio.html
    echo "‚úÖ Relat√≥rio HTML copiado"
else
    # Tentar gerar relat√≥rio se n√£o existir
    echo "üìÑ Relat√≥rio HTML n√£o encontrado. Gerando..."
    cd mackey_glass_prediction
    python generate_interactive_report.py
    cd ..
    
    # Tentar novamente
    if [ -f "$RESULTS_DIR/relatorio.html" ]; then
        cp "$RESULTS_DIR/relatorio.html" docs/relatorio.html
        echo "‚úÖ Relat√≥rio HTML gerado e copiado"
    else
        echo "‚ö†Ô∏è N√£o foi poss√≠vel encontrar/gerar o relat√≥rio HTML"
    fi
fi

# Ajustar caminhos no HTML - Vers√£o Melhorada
if [ -f "docs/relatorio.html" ]; then
    echo "üîß Usando script otimizado para corre√ß√£o de caminhos..."
    
    # Verificar se o script de corre√ß√£o existe
    if [ -f "fix_image_paths.sh" ]; then
        echo "‚úÖ Executando fix_image_paths.sh..."
        chmod +x fix_image_paths.sh
        ./fix_image_paths.sh
    else
        echo "‚ö†Ô∏è Script fix_image_paths.sh n√£o encontrado!"
        echo "üîß Usando m√©todo b√°sico (s√≥ corrige src, n√£o onclick)..."
        
        # Backup do arquivo original
        cp docs/relatorio.html docs/relatorio.html.backup
        
        # Debug: mostrar alguns exemplos de caminhos antes da convers√£o
        echo "üîç Exemplo de caminhos encontrados:"
        grep -o 'src="[^"]*\.\(png\|jpg\|jpeg\|gif\|svg\)"' docs/relatorio.html | head -3
        
        # Estrat√©gia Principal: Substituir arquivos diretos (sem pasta)
        # Exemplo: src="arquivo.png" -> src="images/arquivo.png"
        echo "üîÑ Aplicando corre√ß√£o principal para arquivos diretos..."
        sed -i 's@src="\([^"/]*\.\(png\|jpg\|jpeg\|gif\|svg\)\)"@src="images/\1"@g' docs/relatorio.html
        
        # Estrat√©gia 2: Para arquivos que j√° podem ter uma pasta
        # Exemplo: src="pasta/arquivo.png" -> src="images/pasta/arquivo.png"
        sed -i 's@src="\([^"]*[^/]\)/\([^"]*\.\(png\|jpg\|jpeg\|gif\|svg\)\)"@src="images/\1/\2"@g' docs/relatorio.html
        
        # Estrat√©gia 3: Para caminhos absolutos
        # Exemplo: src="/caminho/arquivo.png" -> src="images/caminho/arquivo.png"
        sed -i 's@src="/\([^"]*\.\(png\|jpg\|jpeg\|gif\|svg\)\)"@src="images/\1"@g' docs/relatorio.html
        
        # Aplicar o mesmo para href (links para arquivos)
        echo "üîó Corrigindo links href..."
        sed -i 's@href="\([^"/]*\.\(png\|jpg\|jpeg\|gif\|svg\|csv\|txt\)\)"@href="images/\1"@g' docs/relatorio.html
        sed -i 's@href="\([^"]*[^/]\)/\([^"]*\.\(png\|jpg\|jpeg\|gif\|svg\|csv\|txt\)\)"@href="images/\1/\2"@g' docs/relatorio.html
        sed -i 's@href="/\([^"]*\.\(png\|jpg\|jpeg\|gif\|svg\|csv\|txt\)\)"@href="images/\1"@g' docs/relatorio.html
        
        # Corrigir duplica√ß√µes que podem ter ocorrido
        echo "üßπ Removendo duplica√ß√µes..."
        sed -i 's@images/images/@images/@g' docs/relatorio.html
        sed -i 's@src="images/images/@src="images/@g' docs/relatorio.html
        sed -i 's@href="images/images/@href="images/@g' docs/relatorio.html
        
        # Debug: mostrar alguns exemplos ap√≥s a convers√£o
        echo "üîÑ Exemplo de caminhos ap√≥s convers√£o:"
        grep -o 'src="[^"]*\.\(png\|jpg\|jpeg\|gif\|svg\)"' docs/relatorio.html | head -3
        
        # Verificar se houve mudan√ßas comparando com backup
        if ! diff -q docs/relatorio.html.backup docs/relatorio.html > /dev/null; then
            echo "‚úÖ Caminhos ajustados com sucesso (m√©todo b√°sico)"
            
            # Mostrar estat√≠sticas
            total_imgs=$(grep -o 'src="[^"]*\.\(png\|jpg\|jpeg\|gif\|svg\)"' docs/relatorio.html | wc -l)
            correct_imgs=$(grep -o 'src="images/[^"]*\.\(png\|jpg\|jpeg\|gif\|svg\)"' docs/relatorio.html | wc -l)
            echo "üìä Estat√≠sticas: $correct_imgs/$total_imgs imagens com caminhos corretos"
            echo "‚ö†Ô∏è Nota: Este m√©todo n√£o corrige eventos onclick!"
            echo "üí° Para corre√ß√£o completa, execute: ./fix_image_paths.sh"
            
            rm docs/relatorio.html.backup
        else
            echo "‚ö†Ô∏è Nenhuma altera√ß√£o foi feita nos caminhos"
            echo "üí° Verifique se os caminhos j√° est√£o corretos ou execute:"
            echo "   ./debug_image_paths.sh"
            rm docs/relatorio.html.backup
        fi
    fi
fi

# Criar p√°gina principal (index.html)
echo "üè† Criando p√°gina principal..."
cat > docs/index.html << 'EOF'
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trabalho 2 RNP - Predi√ß√£o Mackey-Glass</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            border-bottom: 3px solid #3498db;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }
        .card {
            background: white;
            padding: 25px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #3498db;
        }
        .btn {
            display: inline-block;
            background: #3498db;
            color: white;
            padding: 15px 30px;
            text-decoration: none;
            border-radius: 5px;
            margin: 10px 5px;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        .btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        .btn-success {
            background: #27ae60;
            font-size: 1.1em;
        }
        .btn-success:hover {
            background: #229954;
        }
        .author-info {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
            text-align: center;
        }
        .author-info h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .author-info p {
            color: #7f8c8d;
            margin: 5px 0;
        }
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .metric-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        .metric-value {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }
        .highlight {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 3px 8px;
            border-radius: 5px;
            font-weight: bold;
        }
        .footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #ecf0f1;
            color: #7f8c8d;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß† Trabalho 2 - Redes Neurais Profundas</h1>
        <h2 style="text-align: center; color: #7f8c8d; margin-bottom: 30px;">Predi√ß√£o de S√©ries Temporais Mackey-Glass</h2>
        
        <div class="card">
            <h3>üìä Sobre o Projeto</h3>
            <p>Este projeto implementa e compara <span class="highlight">tr√™s tipos de redes neurais</span> (MLP, LSTM, GRU) para predi√ß√£o da s√©rie temporal Mackey-Glass, com m√∫ltiplas configura√ß√µes e varia√ß√µes para an√°lise abrangente.</p>
            
            <div class="results-grid">
                <div class="metric-card">
                    <h4>üèÜ Melhor Modelo</h4>
                    <div class="metric-value">LSTM Bidirectional</div>
                    <p>R¬≤ = 0.990789</p>
                </div>
                <div class="metric-card">
                    <h4>üî¨ Modelos Avaliados</h4>
                    <div class="metric-value">7</div>
                    <p>Configura√ß√µes Otimizadas</p>
                </div>
                <div class="metric-card">
                    <h4>üìà Dataset</h4>
                    <div class="metric-value">998</div>
                    <p>Pontos de Valida√ß√£o</p>
                </div>
            </div>
        </div>

        <div class="card">
            <h3>üåê Relat√≥rio Interativo</h3>
            <p>Acesse o relat√≥rio completo com <strong>visualiza√ß√µes interativas</strong>, m√©tricas detalhadas (EQMN1, EQMN2, R¬≤, RMSE, MAE, MAPE) e an√°lises estat√≠sticas dos experimentos realizados.</p>
            <div style="text-align: center; margin-top: 20px;">
                <a href="relatorio.html" class="btn btn-success">üìä Ver Relat√≥rio Interativo Completo</a>
            </div>
        </div>

        <div class="card">
            <h3>üìö Documenta√ß√£o</h3>
            <p>Explore a documenta√ß√£o completa do projeto:</p>
            <a href="https://github.com/ratacheski/Mackey-Glass-Predicit/blob/master/README.md" class="btn">üìñ README</a>
            <a href="https://github.com/ratacheski/Mackey-Glass-Predicit/blob/master/COMO_USAR.md" class="btn">üöÄ Como Usar</a>
            <a href="https://github.com/ratacheski/Mackey-Glass-Predicit/blob/master/RESULTADOS_FINAIS.md" class="btn">üìà Resultados</a>
            <a href="https://github.com/ratacheski/Mackey-Glass-Predicit/blob/master/RESUMO_EXECUTIVO.md" class="btn">üìä Resumo</a>
        </div>

        <div class="card">
            <h3>üìÅ C√≥digo Fonte</h3>
            <p>Acesse o c√≥digo completo e reproduz√≠vel no GitHub:</p>
            <a href="https://github.com/ratacheski/Mackey-Glass-Predicit" class="btn">üíª Reposit√≥rio GitHub</a>
        </div>

        <div class="author-info">
            <h3>üë®‚Äçüéì Autor</h3>
            <p><strong>Rafael Ratacheski de Sousa Raulino</strong></p>
            <p>Mestrando em Engenharia El√©trica e de Computa√ß√£o - UFG</p>
            <p>Disciplina: Redes Neurais Profundas - 2025/1</p>
            <p>Data: Junho de 2025</p>
        </div>

        <div class="footer">
            <p>üåê Hospedado no GitHub Pages | üî¨ Experimentos realizados com PyTorch</p>
        </div>
    </div>
</body>
</html>
EOF

# Solicitar informa√ß√µes do usu√°rio
echo ""
echo "üîß Configura√ß√£o personalizada:"

echo "‚úÖ P√°gina principal criada"

# Criar arquivo CSS personalizado
echo "üé® Criando estilos personalizados..."
cat > docs/css/styles.css << 'EOF'
/* Estilos adicionais para GitHub Pages */
.github-badge {
    position: fixed;
    top: 0;
    right: 0;
    background: #333;
    color: white;
    padding: 10px 20px;
    text-decoration: none;
    z-index: 1000;
    border-bottom-left-radius: 5px;
}

.github-badge:hover {
    background: #555;
    color: white;
}

/* Responsive design */
@media (max-width: 768px) {
    .container {
        padding: 20px;
        margin: 10px;
    }
    
    .results-grid {
        grid-template-columns: 1fr;
    }
    
    .btn {
        display: block;
        margin: 10px 0;
        text-align: center;
    }
}
EOF

# Verificar arquivos criados
echo ""
echo "üìä Verificando arquivos criados:"
echo "üìÅ docs/"
echo "   ‚îú‚îÄ‚îÄ index.html ‚úÖ"
echo "   ‚îú‚îÄ‚îÄ relatorio.html $([ -f docs/relatorio.html ] && echo "‚úÖ" || echo "‚ùå")"
echo "   ‚îú‚îÄ‚îÄ css/styles.css ‚úÖ"
echo "   ‚îî‚îÄ‚îÄ images/ $([ -d docs/images ] && echo "‚úÖ ($(ls docs/images/ 2>/dev/null | wc -l) arquivos)" || echo "‚ùå")"

# Contar arquivos de imagem
IMG_COUNT=$(find docs/images -type f 2>/dev/null | wc -l)
echo "üñºÔ∏è Total de arquivos copiados: $IMG_COUNT"

echo ""
echo "‚úÖ Configura√ß√£o do GitHub Pages conclu√≠da!"
echo ""
echo "üìã PR√ìXIMOS PASSOS:"
echo "   1. git add docs/"
echo "   2. git commit -m 'Add GitHub Pages configuration with interactive report'"
echo "   3. git push origin master"
echo "   4. Ir para Settings ‚Üí Pages no GitHub"
echo "   5. Configurar Source: 'Deploy from a branch'"
echo "   6. Branch: 'master', Folder: '/docs'"
echo "   7. Aguardar deploy (2-3 minutos)"
echo ""
echo "üåê URL final ser√°:"
echo "   https://ratacheski.github.io/Mackey-Glass-Predicit/"
echo ""
echo "üìä Relat√≥rio interativo em:"
echo "   https://ratacheski.github.io/Mackey-Glass-Predicit/relatorio.html"
echo ""
echo "üí° DICA: Adicione este badge ao seu README.md:"
echo "[![GitHub Pages](https://img.shields.io/badge/GitHub%20Pages-Live%20Demo-brightgreen?style=for-the-badge&logo=github)](https://ratacheski.github.io/Mackey-Glass-Predicit/)" 